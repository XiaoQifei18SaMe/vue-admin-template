# 教练员用例规约


## 1. 基础系统操作

### 1.1 注册系统（UC00）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC00 |
| 用例名称 | 注册系统 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员未注册过系统账号<br>2. 提供有效的手机号（未被占用）及教练资质证明材料（如教练证书） |
| 后置条件 | 1. 系统在`coach`表新增教练员记录（初始状态为“待审核”）<br>2. 自动创建教练员账户（`coach_account`表新增记录，初始余额为0）<br>3. 返回注册成功提示，告知“需等待校区管理员审核” |
| 基本流程 | 1. 教练员访问系统注册页面，选择“教练注册”<br>2. 输入基础信息（手机号、设置密码≥8位含数字+字母、姓名、性别、联系地址）<br>3. 上传资质证明材料（教练证书照片、身份证明），选择意向合作校区<br>4. 点击“提交注册”，系统调用`CoachService.register()`保存信息<br>5. 注册完成，页面提示“注册成功，待校区管理员审核（1-3个工作日）” |
| 扩展流程 | 1. 手机号已被注册：系统提示“该手机号已注册，请直接登录”<br>2. 资质材料未上传：系统提示“请上传教练资质证明，否则无法通过审核”<br>3. 密码格式不满足：系统提示“密码需至少8位，且包含数字和字母” |


### 1.2 登录系统（UC01）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC01 |
| 用例名称 | 登录系统 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已完成注册且通过校区管理员审核<br>2. 输入正确的账号（手机号）和密码 |
| 后置条件 | 1. 系统生成教练角色登录令牌（Token），关联教练ID及所属校区<br>2. 跳转至教练员个人首页，加载基础信息（姓名、所属校区、待处理预约数） |
| 基本流程 | 1. 教练员在登录页输入手机号和密码，点击“登录”<br>2. 系统调用`AuthService.login()`校验账号密码及审核状态<br>3. 校验通过后，`TokenService`生成令牌并返回<br>4. 前端存储令牌，跳转至教练员首页，展示待办事项（如待审核学生绑定、待处理预约） |
| 扩展流程 | 1. 账号未审核：系统提示“您的账号尚未通过审核，请耐心等待”<br>2. 账号被禁用：系统提示“账号已被禁用，请联系校区管理员”<br>3. 密码错误≥3次：系统提示“密码错误次数过多，账号锁定10分钟” |


### 1.3 登出系统（UC02）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC02 |
| 用例名称 | 登出系统 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 1. 登录令牌失效，无法访问教练员专属功能<br>2. 清除前端缓存的个人信息及待办数据，跳转至登录页 |
| 基本流程 | 1. 教练员点击个人首页右上角“登出”按钮<br>2. 系统调用`AuthService.logout()`销毁当前令牌<br>3. 页面自动跳转至登录页，提示“已安全登出” |
| 扩展流程 | - |


## 2. 个人信息维护（UC1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC1 |
| 用例名称 | 维护个人信息 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 教练员信息更新至`coach`表（可修改字段：姓名、联系电话、专长、授课风格、头像、简介） |
| 基本流程 | 1. 教练员进入“个人中心-个人信息”页面<br>2. 点击“编辑”按钮，修改目标字段（如更新专长为“乒乓球发球技巧”、上传新头像）<br>3. 若修改手机号，需通过原手机号获取验证码完成身份校验<br>4. 点击“保存”，系统调用`CoachService.updateInfo()`校验并保存数据<br>5. 保存成功，页面刷新展示更新后信息，同步更新教练广场的公开信息 |
| 扩展流程 | 1. 新手机号已被占用：系统提示“该手机号已被使用，请更换其他手机号”<br>2. 头像格式错误（非图片格式）：系统提示“请上传JPG/PNG格式的头像图片”<br>3. 专长字段为空：系统提示“请填写您的教学专长，方便学员了解” |


## 3. 学生广场模块

### 3.1 审核学生（UC2_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_1 |
| 用例名称 | 审核学生 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在学员发起的“绑定教练”申请（`student_coach_apply`表有待审核记录） |
| 后置条件 | 1. 申请记录状态更新（“通过”或“拒绝”）<br>2. 通过时在`student_coach`表新增绑定关系，拒绝时记录拒绝原因 |
| 基本流程 | 1. 教练员进入“学生广场-待审核申请”页面<br>2. 系统调用`StudentCoachService.getPendingApplies()`获取待审核学生申请列表（含学员姓名、所属校区、申请时间）<br>3. 选择目标申请，点击“查看详情”了解学员基础信息（如学习阶段、目标）<br>4. 点击“通过”或“拒绝”，拒绝时需填写原因（必填）<br>5. 系统调用`StudentCoachService.auditApply()`更新申请状态，返回审核结果提示 |
| 扩展流程 | 1. 无待审核申请：页面提示“暂无学员绑定申请”<br>2. 申请已被处理：系统提示“该申请已审核，无需重复操作” |


### 3.2 查看我的学生信息（UC2_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_2 |
| 用例名称 | 查看我的学生信息 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在已绑定的学员（`student_coach`表有有效关联记录） |
| 后置条件 | 系统展示教练员所有绑定学员的列表及详情（含学习记录、预约情况） |
| 基本流程 | 1. 教练员进入“学生广场-我的学生”页面<br>2. 系统调用`StudentCoachService.getMyStudents()`获取绑定学员列表（分页展示，含学员姓名、头像、剩余课时、最近上课时间）<br>3. 点击目标学员“查看详情”，展示学员基础信息、历史课程记录、已预约课程、评价记录<br>4. 支持按“最近上课时间”“剩余课时”排序筛选学员 |
| 扩展流程 | 1. 无绑定学员：页面提示“您暂无绑定学员，可等待学员申请或提升教练广场曝光” |


### 3.3 处理更换教练申请（UC2_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_3 |
| 用例名称 | 处理更换教练申请 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在学员发起的“更换教练”申请（涉及当前教练为“原教练”） |
| 后置条件 | 1. 申请记录状态更新为“原教练确认”<br>2. 同步通知校区管理员进行最终审批 |
| 基本流程 | 1. 教练员收到“学员更换教练”通知，进入“学生广场-更换申请”页面<br>2. 系统调用`StudentCoachService.getChangeApplications()`获取涉及自身的更换申请（含学员姓名、新教练、申请原因）<br>3. 教练员确认申请信息，点击“确认”按钮（无需拒绝，仅确认知晓）<br>4. 系统调用`StudentCoachService.confirmChangeApply()`更新状态，提示“已确认学员更换申请，等待管理员审批” |
| 扩展流程 | 1. 申请已被确认：系统提示“该更换申请已确认，无需重复操作” |


## 4. 预约管理模块

### 4.1 同意或拒绝学员预约（UC3_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_1 |
| 用例名称 | 同意或拒绝学员预约 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在学员发起的“待教练确认”状态的课程预约（`reservation`表状态为“pending”） |
| 后置条件 | 1. 预约记录状态更新为“已同意”（confirmed）或“已拒绝”（rejected）<br>2. 发送结果通知给学员（如“您的预约已通过”“您的预约已被拒绝”） |
| 基本流程 | 1. 教练员进入“预约管理-待确认预约”页面<br>2. 系统调用`ReservationService.getPendingReservations()`获取待确认预约列表（含学员姓名、课程时间、场地）<br>3. 教练员查看预约信息，判断是否可接单：<br>   - 同意：点击“同意”，系统更新状态为“confirmed”，锁定课程名额<br>   - 拒绝：点击“拒绝”，填写拒绝原因（必填），系统更新状态为“rejected”，释放课程名额<br>4. 操作完成，页面提示“预约处理成功”，同步发送通知给学员 |
| 扩展流程 | 1. 预约已超时（超过24小时未处理）：系统自动拒绝，提示“该预约已超时自动拒绝”<br>2. 课程时间冲突：系统提示“您已预约该时间段的课程，建议拒绝此预约” |


### 4.2 查看一周课表（UC3_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_2 |
| 用例名称 | 查看一周课表 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 系统展示教练员未来7天的课程安排（含已确认预约、待确认预约） |
| 基本流程 | 1. 教练员进入“预约管理-我的课表”页面<br>2. 系统调用`ScheduleService.getCoachWeekSchedule()`获取教练关联的课表（按日期分组，标注课程时间、学员、场地、预约状态）<br>3. 页面以“日视图”展示，区分“已确认”（绿色）、“待确认”（黄色）、“空闲”（白色）时段<br>4. 点击课程可查看详情（学员信息、预约状态），支持切换“上一周”“下一周” |
| 扩展流程 | 1. 未来7天无课程：页面提示“未来7天暂无课程安排，可等待学员预约” |


### 4.3 取消预约（UC3_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_3 |
| 用例名称 | 取消预约 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已同意”状态的预约，且距离上课时间≥4小时 |
| 后置条件 | 1. 预约记录状态更新为“教练取消”（coach_canceled）<br>2. 释放课程名额，退还学员课时/金额至账户<br>3. 发送“教练取消预约”通知给学员 |
| 基本流程 | 1. 教练员在“我的课表”或“预约管理-已确认预约”中找到目标预约<br>2. 点击“取消预约”按钮，填写取消原因（必填，如“临时有事”）<br>3. 系统弹出确认弹窗（“确认取消该预约？取消后将退还学员课时”）<br>4. 点击“确认”，系统调用`ReservationService.coachCancelReservation()`更新状态<br>5. 操作完成，页面提示“预约已取消，已通知学员” |
| 扩展流程 | 1. 距离上课时间<4小时：系统提示“距离上课时间不足4小时，无法取消预约，请联系管理员协助”<br>2. 预约已完成/取消：系统提示“该预约已失效，无需取消” |


### 4.4 处理学生取消预约（UC3_4）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_4 |
| 用例名称 | 处理学生取消预约 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在学员发起的“待教练确认”状态的取消申请（`reservation`表状态为“student_canceling”） |
| 后置条件 | 1. 预约记录状态更新为“已取消”（canceled）<br>2. 系统同步更新课程名额，教练员可查看取消原因 |
| 基本流程 | 1. 教练员收到“学员申请取消预约”通知，进入“预约管理-取消申请”页面<br>2. 系统调用`ReservationService.getStudentCancelApplications()`获取申请列表（含学员姓名、课程时间、取消原因）<br>3. 教练员查看申请信息，点击“确认”按钮（无需拒绝，仅确认知晓）<br>4. 系统调用`ReservationService.confirmStudentCancel()`更新状态，提示“已确认学员取消预约” |
| 扩展流程 | 1. 学员取消申请已超时：系统自动确认，提示“该取消申请已超时自动确认” |


## 5. 课程评价模块

### 5.1 查看我的评价和收到的评价（UC4_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4_1 |
| 用例名称 | 查看我的评价和收到的评价 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 系统分别展示“教练员发表的评价（对学员）”和“收到的评价（学员对教练）”列表 |
| 基本流程 | 1. 教练员进入“课程评价-评价管理”页面<br>2. 页面分为两个标签页：<br>   - “我发表的评价”：调用`CommentService.getCoachComments()`展示教练员对学员的课程评价（含学员姓名、课程时间、评分、内容）<br>   - “我收到的评价”：调用`CommentService.getCoachReceivedComments()`展示学员对教练员的评价（含学员姓名、课程时间、评分、内容、回复状态）<br>3. 支持按“时间”“评分”筛选评价，支持分页查看 |
| 扩展流程 | 1. 无评价记录：对应标签页提示“暂无评价记录” |


### 5.2 新增评价（UC4_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4_2 |
| 用例名称 | 新增评价 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已完成”状态的课程，且未对该课程的学员发表评价 |
| 后置条件 | 1. 系统在`comment`表新增评价记录（关联教练ID、学员ID、课程ID）<br>2. 发送“教练已评价”通知给学员 |
| 基本流程 | 1. 教练员进入“课程评价-待评价课程”页面<br>2. 系统调用`CommentService.getCoachPendingComments()`获取待评价课程列表（含学员姓名、课程时间）<br>3. 点击“评价”按钮，进入编辑页：选择评分（1-5星）、填写评价内容（≥10字，如“学员进步明显，发球技巧需加强”）<br>4. 点击“提交评价”，系统调用`CommentService.createCoachComment()`保存数据<br>5. 提交成功，页面提示“评价发表成功” |
| 扩展流程 | 1. 已发表评价：系统提示“您已对该学员的此课程发表评价，无法重复评价”<br>2. 评价内容<10字：系统提示“评价内容需至少10字，请补充细节” |


### 5.3 编辑我的评价（UC4_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4_3 |
| 用例名称 | 编辑我的评价 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已发表”状态的评价（对学员），且距离发表时间≤7天 |
| 后置条件 | 评价记录（评分、内容）更新至`comment`表 |
| 基本流程 | 1. 教练员进入“课程评价-我发表的评价”页面<br>2. 找到目标评价，点击“编辑”按钮<br>3. 修改评分或评价内容（规则同新增评价）<br>4. 点击“保存修改”，系统调用`CommentService.updateCoachComment()`更新数据<br>5. 保存成功，页面刷新展示更新后评价，同步通知学员“教练已更新对您的评价” |
| 扩展流程 | 1. 距离发表时间>7天：系统提示“评价发表超过7天，无法编辑”<br>2. 学员已回复该评价：系统提示“学员已回复此评价，无法编辑” |


### 5.4 删除我的评价（UC4_4）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4_4 |
| 用例名称 | 删除我的评价 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已发表”状态的评价（对学员） |
| 后置条件 | 评价记录状态更新为“已删除”（逻辑删除，保留数据） |
| 基本流程 | 1. 教练员进入“课程评价-我发表的评价”页面<br>2. 找到目标评价，点击“删除”按钮<br>3. 系统弹出确认弹窗（“确认删除该评价？删除后不可恢复”）<br>4. 点击“确认”，系统调用`CommentService.deleteCoachComment()`更新状态<br>5. 删除成功，页面提示“评价已删除”，列表中不再展示该评价 |
| 扩展流程 | 1. 学员已回复该评价：系统提示“该评价已收到学员回复，删除后回复也将隐藏，是否继续？”（确认后可删除） |


## 6. 账号管理模块

### 6.1 查看交易记录（UC5_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_1 |
| 用例名称 | 查看交易记录 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 系统展示教练员账户的所有交易记录（收入、提现、退款），支持筛选 |
| 基本流程 | 1. 教练员进入“账号管理-交易记录”页面<br>2. 系统调用`CoachAccountService.getTransactionRecords()`获取交易记录（默认展示近30天数据）<br>3. 记录按“时间倒序”展示，每条包含“交易类型（收入/提现/退款）、金额、时间、关联课程/提现单、状态”<br>4. 支持按“交易类型”“时间范围”筛选，支持分页查看 |
| 扩展流程 | 1. 无交易记录：页面提示“暂无交易记录” |


### 6.2 查看余额（UC5_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_2 |
| 用例名称 | 查看余额 |
| 参与者 | 教练员 |
| 前置条件 | 教练员已登录系统 |
| 后置条件 | 系统展示教练员账户当前可用余额、待结算金额（若有） |
| 基本流程 | 1. 教练员进入“账号管理-账户余额”页面<br>2. 系统调用`CoachAccountService.getBalance()`查询`coach_account`表数据<br>3. 页面展示“可用余额（元）”“待结算金额（元，如有）”，及最近1条交易记录<br>4. 提供“余额说明”弹窗，解释“可用余额=已结算收入-已提现金额” |
| 扩展流程 | - |


### 6.3 提现余额（UC5_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_3 |
| 用例名称 | 提现余额 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 账户可用余额≥提现最低金额（如100元）<br>3. 已绑定有效的提现账户（银行卡/支付宝） |
| 后置条件 | 1. 系统在`coach_withdrawal`表新增提现申请记录（状态为“待审核”）<br>2. 冻结申请金额（可用余额减少对应金额，转入“待提现”金额）<br>3. 发送“提现申请提交成功”通知给教练员 |
| 基本流程 | 1. 教练员进入“账号管理-提现”页面<br>2. 选择提现方式（银行卡/支付宝，需已绑定）<br>3. 输入提现金额（≥100元，≤可用余额）<br>4. 点击“提交提现”，系统调用`CoachAccountService.applyWithdrawal()`生成申请<br>5. 提交成功，页面提示“提现申请已提交，待管理员审核（1-3个工作日）”，展示申请单号 |
| 扩展流程 | 1. 可用余额不足：系统提示“可用余额不足，当前可用余额XX元”<br>2. 未绑定提现账户：系统提示“请先在‘账户设置’中绑定提现账户”<br>3. 提现金额<最低限额：系统提示“提现最低金额为100元，请调整金额” |


## 7. 通知模块

### 7.1 更换教练通知（UC6_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6_1 |
| 用例名称 | 更换教练通知 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 涉及自身的教练更换申请状态变更（如学员发起申请、管理员审批通过） |
| 后置条件 | 教练员查看通知详情，了解更换申请进度或结果 |
| 基本流程 | 1. 系统在更换申请状态变更时，自动发送通知至教练员“消息中心”<br>   - 作为“原教练”：通知内容为“学员XX发起更换教练申请，请确认”<br>   - 作为“新教练”：通知内容为“学员XX的更换教练申请已通过，您已成为其新教练”<br>2. 教练员点击通知进入详情页，查看完整申请信息及进度<br>3. 支持点击“去处理”直接跳转至对应操作页面（如待确认申请页） |
| 扩展流程 | - |


### 7.2 上课提醒（UC6_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6_2 |
| 用例名称 | 上课提醒 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已同意”状态的课程，且距离上课时间=2小时 |
| 后置条件 | 教练员查看提醒，确认上课时间、学员、场地信息 |
| 基本流程 | 1. 系统在上课前2小时自动发送提醒至教练员“消息中心”（含APP推送）<br>2. 提醒内容包含“课程时间、学员姓名、场地、课程类型”<br>3. 教练员点击提醒可跳转至“我的课表”页面，查看学员详情或取消预约（符合条件时） |
| 扩展流程 | - |


### 7.3 评课提醒（UC6_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6_3 |
| 用例名称 | 评课提醒 |
| 参与者 | 教练员 |
| 前置条件 | 1. 教练员已登录系统<br>2. 存在“已完成”状态的课程，且未对该课程的学员发表评价，距离课程结束≤24小时 |
| 后置条件 | 教练员查看提醒，跳转至评价页面完成评价 |
| 基本流程 | 1. 课程结束后，系统发送“评课提醒”至教练员“消息中心”<br>2. 提醒内容包含“已完成课程：XX（学员）-XX时间，请及时评价”<br>3. 教练员点击“去评价”按钮，直接跳转至该课程的评价编辑页<br>4. 评价完成后，提醒状态更新为“已处理” |
| 扩展流程 | 1. 已完成评价：系统自动清除未读提醒，不再重复发送 |
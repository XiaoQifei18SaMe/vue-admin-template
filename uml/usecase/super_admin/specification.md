# 超级管理员用例规约


## 1. 基础系统操作

### 1.1 登录系统（UC01）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC01 |
| 用例名称 | 登录系统 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员未登录系统，且具备有效的超级管理员账号密码 |
| 后置条件 | 验证通过后，超级管理员成功登录系统，获得访问权限并生成登录令牌（Token） |
| 基本流程 | 1. 超级管理员在登录页面输入用户名和密码；<br>2. 系统调用`SuperAdminService.login`方法验证用户名和密码；<br>3. 验证通过后，系统通过`TokenService`生成并返回登录令牌；<br>4. 超级管理员进入系统首页 |
| 扩展流程 | 1. 若用户名不存在（`superAdminRepository.findByUsername`返回null），系统提示“用户名不存在”；<br>2. 若密码错误（输入密码与数据库存储密码不匹配），系统提示“密码错误” |


### 1.2 登出系统（UC02）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC02 |
| 用例名称 | 登出系统 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统 |
| 后置条件 | 超级管理员登录状态失效，无法再访问系统功能 |
| 基本流程 | 1. 超级管理员点击“登出”按钮；<br>2. 系统销毁当前登录令牌（Token）；<br>3. 超级管理员被重定向至登录页面 |


## 2. 个人信息维护

### 2.1 维护个人信息（UC1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC1 |
| 用例名称 | 维护个人信息 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统 |
| 后置条件 | 超级管理员信息更新成功并保存至数据库 |
| 基本流程 | 1. 超级管理员进入个人信息页面，选择“编辑”；<br>2. 输入修改后的信息（用户名、密码、姓名、电话等）；<br>3. 提交修改，系统调用`SuperAdminService.updateInfo`方法；<br>4. 系统校验并保存更新后的信息，返回成功提示 |
| 扩展流程 | 1. 若修改的用户名已存在（排除自身），系统提示“用户名已存在”；<br>2. 若提交信息存在空值（如必填字段为空），系统提示“必需字段不能为空” |


## 3. 管理员管理

### 3.1 新增管理员（UC2_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_1 |
| 用例名称 | 新增管理员 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待新增的管理员用户名未被占用 |
| 后置条件 | 新管理员信息保存至数据库，生成管理员记录 |
| 基本流程 | 1. 超级管理员进入管理员管理页面，点击“新增”；<br>2. 输入管理员信息（用户名、密码、姓名、电话等）；<br>3. 提交信息，系统调用`SuperAdminService.createAdmin`方法；<br>4. 系统检查用户名唯一性，校验通过后保存数据，返回成功提示 |
| 扩展流程 | 1. 若用户名已存在（`adminRepository.findByUsername`返回非null），系统提示“用户名已存在”；<br>2. 若必填字段为空，系统提示“必需字段空缺” |


### 3.2 编辑管理员（UC2_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_2 |
| 用例名称 | 编辑管理员 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待编辑的管理员存在 |
| 后置条件 | 管理员信息更新成功并保存至数据库 |
| 基本流程 | 1. 超级管理员进入管理员列表，选择目标管理员点击“编辑”；<br>2. 修改管理员信息（用户名、密码、姓名等）；<br>3. 提交修改，系统调用`SuperAdminService.editAdmin`方法；<br>4. 系统校验信息（如用户名唯一性），保存更新后的数据，返回成功提示 |
| 扩展流程 | 1. 若管理员不存在（`adminRepository.findById`返回空），系统提示“管理员不存在”；<br>2. 若并发修改导致乐观锁冲突，系统提示“数据已被修改，请刷新后重试” |


### 3.3 删除管理员（UC2_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2_3 |
| 用例名称 | 删除管理员 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待删除的管理员存在，且无关联校区 |
| 后置条件 | 管理员记录从数据库中删除 |
| 基本流程 | 1. 超级管理员进入管理员列表，选择目标管理员点击“删除”；<br>2. 系统调用`SuperAdminService.deleteAdmin`方法，检查管理员是否存在及是否关联校区；<br>3. 校验通过后删除管理员记录，返回成功提示 |
| 扩展流程 | 1. 若管理员不存在，系统提示“管理员不存在”；<br>2. 若管理员关联了校区（`schoolRepository.findByAdminId`返回非空列表），系统提示“该管理员关联了校区，请先解除关联” |


## 4. 校区管理

### 4.1 新增校区（UC3_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_1 |
| 用例名称 | 新增校区 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统 |
| 后置条件 | 校区信息保存至数据库，且根据设置的球台数量生成对应球台记录 |
| 基本流程 | 1. 超级管理员进入校区管理页面，点击“新增”；<br>2. 输入校区信息（名称、地址、联系电话、球台数量、关联管理员ID等）；<br>3. 提交信息，系统调用`SuperAdminService.createSchool`方法；<br>4. 系统保存校区信息，并根据`table_num`生成对应数量的球台（`TableEntity`），返回成功提示 |
| 扩展流程 | 1. 若必填字段为空，系统提示“必需字段空缺”；<br>2. 若数据库操作失败，系统提示“创建学校失败” |


### 4.2 编辑校区（UC3_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_2 |
| 用例名称 | 编辑校区 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待编辑的校区存在 |
| 后置条件 | 校区信息更新成功，若球台数量修改，球台记录同步更新 |
| 基本流程 | 1. 超级管理员进入校区列表，选择目标校区点击“编辑”；<br>2. 修改校区信息（名称、地址、球台数量等）；<br>3. 提交修改，系统调用`SuperAdminService.reviseSchool`方法；<br>4. 系统更新校区基本信息，若球台数量变化，则删除原有球台并重新生成对应数量的球台，返回成功提示 |
| 扩展流程 | 1. 若校区不存在，系统提示“学校不存在”；<br>2. 若球台数量更新失败，系统提示“编辑校区失败” |


### 4.3 删除校区（UC3_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_3 |
| 用例名称 | 删除校区 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待删除的校区存在，且无关联数据（如学生、教练等） |
| 后置条件 | 校区记录及关联的球台、课表等数据从数据库中删除 |
| 基本流程 | 1. 超级管理员进入校区列表，选择目标校区点击“删除”；<br>2. 系统调用`SuperAdminService.deleteSchool`方法，检查校区是否存在及是否有关联数据；<br>3. 校验通过后删除校区及关联数据，返回成功提示 |
| 扩展流程 | 1. 若校区不存在，系统提示“学校不存在”；<br>2. 若校区有关联数据（如学生），系统提示“该校区存在关联数据，无法删除” |


## 5. 教练审核（UC4）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4 |
| 用例名称 | 教练审核 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，存在待审核的教练申请 |
| 后置条件 | 教练审核状态更新（通过/拒绝），通过时创建教练账户 |
| 基本流程 | 1. 超级管理员进入教练审核页面，调用`SuperAdminService.getAllUncertifiedCoaches`获取待审核教练列表；<br>2. 选择目标教练，查看详情（`getSuperCoachDetail`）；<br>3. 选择“通过”或“拒绝”，提交审核结果；<br>4. 系统调用`superCertifyCoach`方法，通过则设置`certified=true`并调用`coachAccountService.createCoachAccount`创建账户，拒绝则删除教练记录；<br>5. 返回审核结果提示 |
| 扩展流程 | 1. 若教练不存在，系统提示“该教练不存在”；<br>2. 若审核通过时创建账户失败，系统提示“审核通过但账户创建失败，请重试” |


## 6. 信息管理

### 6.1 学生管理
#### 6.1.1 搜索学生（UC5_1_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_1_1 |
| 用例名称 | 搜索学生 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统 |
| 后置条件 | 系统返回符合条件的学生列表（分页） |
| 基本流程 | 1. 超级管理员进入学生管理页面，输入搜索条件（校区ID、姓名等）；<br>2. 提交搜索，系统调用`SuperAdminService.getAllStudentsWithPage`方法；<br>3. 系统根据条件分页查询学生数据（`studentRepository`），返回结果列表 |
| 扩展流程 | 1. 若未输入搜索条件，返回所有学生分页数据；<br>2. 若查询失败，系统提示“获取学生列表失败” |


#### 6.1.2 编辑学生信息（UC5_1_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_1_2 |
| 用例名称 | 编辑学生信息 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待编辑的学生存在 |
| 后置条件 | 学生信息更新成功并保存至数据库 |
| 基本流程 | 1. 超级管理员在学生列表中选择目标学生，点击“编辑”；<br>2. 修改学生信息（姓名、电话、所属校区等）；<br>3. 提交修改，系统调用`SuperAdminService.updateStudent`方法；<br>4. 系统校验并保存更新后的数据，返回成功提示 |
| 扩展流程 | 1. 若学生不存在，系统提示“学生不存在”；<br>2. 若令牌无效（权限不足），系统提示“令牌无效” |


### 6.2 教练管理
#### 6.2.1 搜索教练（UC5_2_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_2_1 |
| 用例名称 | 搜索教练 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统 |
| 后置条件 | 系统返回符合条件的已认证教练列表（分页） |
| 基本流程 | 1. 超级管理员进入教练管理页面，输入搜索条件（校区ID、姓名、等级等）；<br>2. 提交搜索，系统调用`SuperAdminService.getAllCertifiedCoachesWithPage`方法；<br>3. 系统根据条件分页查询已认证教练数据（`coachRepository`），返回结果列表 |
| 扩展流程 | 1. 若未输入搜索条件，返回所有已认证教练分页数据；<br>2. 若查询失败，系统提示“获取教练列表失败” |


#### 6.2.2 编辑教练信息（UC5_2_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5_2_2 |
| 用例名称 | 编辑教练信息 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待编辑的教练存在（已认证） |
| 后置条件 | 教练信息更新成功并保存至数据库 |
| 基本流程 | 1. 超级管理员在教练列表中选择目标教练，点击“编辑”；<br>2. 修改教练信息（姓名、电话、等级、所属校区等）；<br>3. 提交修改，系统调用`SuperAdminService.updateCertifiedCoach`方法；<br>4. 系统校验并保存更新后的数据，返回成功提示 |
| 扩展流程 | 1. 若教练不存在，系统提示“教练不存在”；<br>2. 若令牌无效（权限不足），系统提示“令牌无效” |


## 7. 线下学生充值（UC6）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6 |
| 用例名称 | 线下学生充值 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且目标学生存在 |
| 后置条件 | 学生账户余额增加，生成充值记录 |
| 基本流程 | 1. 超级管理员进入学生充值页面，输入学生ID和充值金额；<br>2. 提交充值，系统调用`PaymentService.adminOfflineRecharge`方法；<br>3. 系统查询学生账户，增加余额并生成支付记录（`PaymentRecordEntity`）；<br>4. 返回充值成功提示及记录信息 |
| 扩展流程 | 1. 若学生不存在，系统提示“学生不存在”；<br>2. 若充值金额为负数或零，系统提示“充值金额无效” |


## 8. 课表管理

### 8.1 创建校区课表（UC8_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC8_1 |
| 用例名称 | 创建校区课表 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且目标校区存在，且该校区暂无课表 |
| 后置条件 | 校区课表记录保存至数据库（`ScheduleEntity`） |
| 基本流程 | 1. 超级管理员进入课表管理页面，选择目标校区；<br>2. 选择课表来源（使用默认模板/复用其他校区模板）；<br>   - 若用默认模板：调用`ScheduleService.getDefaultSchedule`获取默认课表（周一至周日9:00-18:00）；<br>   - 若复用模板：调用`ScheduleService.getScheduleTemplate`获取指定校区课表；<br>3. 确认课表信息后提交，系统调用`ScheduleService.saveSchedule`方法；<br>4. 系统保存课表并关联校区ID，返回成功提示 |
| 扩展流程 | 1. 若校区已存在课表（`ScheduleService.hasSchedule`返回true），系统提示“该校区已存在课表，请先修改或删除”；<br>2. 若保存失败，系统提示“课表创建失败” |


### 8.2 修改校区课表（UC8_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC8_2 |
| 用例名称 | 修改校区课表 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且目标校区存在且已有课表 |
| 后置条件 | 校区课表现有记录更新成功 |
| 基本流程 | 1. 超级管理员进入课表管理页面，选择目标校区，调用`ScheduleService.getSchoolSchedule`获取当前课表；<br>2. 修改课表信息（时间段、描述等）；<br>3. 提交修改，系统调用`ScheduleService.saveSchedule`方法（先删除原有课表，再保存新课表）；<br>4. 系统更新课表记录，返回成功提示 |
| 扩展流程 | 1. 若校区无课表，系统提示“该校区暂无课表，请先创建”；<br>2. 若修改后的数据无效（如结束时间早于开始时间），系统提示“课表时间设置无效” |


## 9. 比赛管理

### 9.1 新增比赛（UC9_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC9_1 |
| 用例名称 | 新增比赛 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且比赛时间设置有效（截止时间早于开始时间，且开始时间在未来） |
| 后置条件 | 比赛记录保存至数据库（`MonthlyMatchEntity`） |
| 基本流程 | 1. 超级管理员进入比赛管理页面，点击“新增比赛”；<br>2. 输入比赛信息（标题、开始时间、报名截止时间等）；<br>3. 提交信息，系统调用`MonthlyMatchService.createMatchByAdmin`方法；<br>4. 系统校验时间有效性（截止时间≤开始时间，开始时间≥当前时间），设置比赛状态（未开始/报名中/报名截止），保存记录并返回成功提示 |
| 扩展流程 | 1. 若报名截止时间晚于开始时间，系统提示“报名截止时间不能晚于比赛开始时间”；<br>2. 若开始时间在过去，系统提示“不能创建过去的比赛” |


### 9.2 编辑比赛（UC9_2）
| 项目 | 内容 |
|------|------|
| 用例名称 | 编辑比赛 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且待编辑的比赛存在 |
| 后置条件 | 比赛信息更新成功并保存至数据库 |
| 基本流程 | 1. 超级管理员在比赛列表中选择目标比赛，点击“编辑”；<br>2. 修改比赛信息（标题、时间等）；<br>3. 提交修改，系统校验时间有效性后更新比赛记录；<br>4. 返回编辑成功提示 |
| 扩展流程 | 1. 若比赛不存在，系统提示“比赛不存在”；<br>2. 若修改后的时间无效（同新增比赛校验规则），系统提示“时间设置无效” |


### 9.3 安排赛程（UC9_3）
| 项目 | 内容 |
|------|------|
| 用例名称 | 安排赛程 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且比赛已创建 |
| 后置条件 | 赛程安排信息保存至数据库 |
| 基本流程 | 1. 超级管理员进入目标比赛详情页，点击“安排赛程”；<br>2. 设置赛程阶段（如小组赛、淘汰赛）、对阵信息、时间、场地等；<br>3. 提交赛程，系统保存赛程信息；<br>4. 返回安排成功提示 |


### 9.4 查看赛程（UC9_4）
| 项目 | 内容 |
|------|------|
| 用例名称 | 查看赛程 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，且比赛已创建并安排赛程 |
| 后置条件 | 系统返回目标比赛的赛程详情 |
| 基本流程 | 1. 超级管理员进入比赛列表，选择目标比赛点击“查看赛程”；<br>2. 系统查询并展示该比赛的赛程阶段、对阵信息、时间等；<br>3. 超级管理员查看赛程详情 |


## 10. 系统激活（UC10）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC10 |
| 用例名称 | 系统激活 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，已完成服务费支付（500元/年） |
| 后置条件 | 系统激活记录生成（`SystemActivation`），设备与激活信息关联 |
| 基本流程 | 1. 超级管理员进入系统激活页面，点击“支付服务费”（调用`SystemActivationService.payServiceFee`）；<br>2. 支付完成后，输入设备唯一标识（deviceId）；<br>3. 点击“激活系统”，系统调用`SystemActivationService.activateSystem`方法；<br>4. 系统生成激活记录（包含有效期），关联设备ID，返回激活成功提示 |
| 扩展流程 | 1. 若未支付服务费，系统提示“请先完成服务费支付”；<br>2. 若设备ID已被激活，系统提示“该设备已激活” |


## 11. 教练更换审批（UC7）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC7 |
| 用例名称 | 教练更换审批 |
| 参与者 | 超级管理员 |
| 前置条件 | 超级管理员已登录系统，存在待审批的教练更换申请 |
| 后置条件 | 更换申请状态更新（通过/拒绝），通过时更新学生-教练关联关系 |
| 基本流程 | 1. 超级管理员进入教练更换审批页面，查看待审批申请列表；<br>2. 选择目标申请，查看详情（原教练、新教练、学生信息等）；<br>3. 选择“通过”或“拒绝”，提交审批结果；<br>4. 系统更新申请状态，通过则更新`CoachTeachStudentRepository`中的关联关系；<br>5. 返回审批结果提示 |


## 12. 更换教练信息通知（UC11）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC11 |
| 用例名称 | 更换教练信息通知 |
| 参与者 | 超级管理员 |
| 前置条件 | 教练更换审批已通过 |
| 后置条件 | 学生和涉及的教练收到更换通知 |
| 基本流程 | 1. 教练更换审批通过后，系统自动触发通知流程；<br>2. 系统向学生、原教练、新教练发送信息通知（如站内信），告知教练更换结果；<br>3. 通知状态记录至系统 |
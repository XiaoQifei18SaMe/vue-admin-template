# 校区管理员用例规约


## 1. 基础系统操作

### 1.1 登录系统（UC01）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC01 |
| 用例名称 | 登录系统 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员未登录系统<br>2. 拥有有效的校区管理员账号密码 |
| 后置条件 | 1. 验证通过后，校区管理员成功登录系统<br>2. 系统生成并返回登录令牌（Token），关联所属校区权限 |
| 基本流程 | 1. 校区管理员在登录页面输入用户名和密码<br>2. 系统调用`AdminController.login()`方法验证身份<br>3. 验证通过后，`TokenService`生成包含校区ID的角色令牌<br>4. 跳转至校区管理员专属首页 |
| 扩展流程 | 1. 用户名不存在：系统提示“用户名不存在”<br>2. 密码错误：系统提示“密码错误”<br>3. 账号未分配校区：系统提示“请联系超级管理员分配校区” |


### 1.2 登出系统（UC02）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC02 |
| 用例名称 | 登出系统 |
| 参与者 | 校区管理员 |
| 前置条件 | 校区管理员已登录系统 |
| 后置条件 | 1. 登录令牌失效，无法访问系统功能<br>2. 页面自动跳转至登录页 |
| 基本流程 | 1. 校区管理员点击页面右上角“登出”按钮<br>2. 系统调用`AdminController.logout()`销毁当前令牌<br>3. 清除本地缓存的用户信息 |
| 扩展流程 | - |


## 2. 个人信息维护（UC1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC1 |
| 用例名称 | 维护个人信息 |
| 参与者 | 校区管理员 |
| 前置条件 | 校区管理员已登录系统 |
| 后置条件 | 个人信息更新至数据库`admin`表 |
| 基本流程 | 1. 校区管理员进入“个人中心”页面<br>2. 点击“编辑信息”，修改可编辑字段（姓名、联系电话、密码等）<br>3. 提交修改，系统调用`AdminService.updateInfo()`方法<br>4. 系统校验数据有效性后保存，返回更新成功提示 |
| 扩展流程 | 1. 用户名重复：系统提示“用户名已被使用”<br>2. 密码格式错误（长度不足8位）：系统提示“密码长度至少8位”<br>3. 联系电话格式错误：系统提示“请输入有效的电话号码” |


## 3. 教练审核（UC2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC2 |
| 用例名称 | 教练审核 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 存在本校区提交的待审核教练申请 |
| 后置条件 | 1. 教练状态更新（`certified`字段设为`true`或记录被删除）<br>2. 审核通过时自动创建教练账户（`coach_account`表新增记录） |
| 基本流程 | 1. 校区管理员进入“教练管理-待审核列表”<br>2. 系统调用`AdminService.getUncertifiedCoaches(schoolId)`获取本校区待审核教练<br>3. 选择目标教练，查看详情（包含资质证明材料）<br>4. 点击“通过”或“拒绝”，提交审核结果<br>5. 系统调用`AdminService.certifyCoach(coachId, result)`处理结果 |
| 扩展流程 | 1. 审核通过但账户创建失败：系统提示“审核通过，账户创建失败，请重试”<br>2. 教练申请已被处理：系统提示“该申请已审核，无需重复操作” |


## 4. 信息管理

### 4.1 学生管理
#### 4.1.1 搜索学生（UC3_1_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_1_1 |
| 用例名称 | 搜索学生 |
| 参与者 | 校区管理员 |
| 前置条件 | 校区管理员已登录系统 |
| 后置条件 | 系统返回本校区符合条件的学生分页列表 |
| 基本流程 | 1. 校区管理员进入“学生管理”页面<br>2. 输入搜索条件（姓名、学号、手机号）<br>3. 点击“搜索”，系统调用`AdminService.searchStudents(schoolId, keyword, page)`<br>4. 展示搜索结果（包含学生姓名、所属班级、剩余课时等信息） |
| 扩展流程 | 1. 无搜索条件：返回本校区所有学生分页数据<br>2. 无匹配结果：显示“未找到符合条件的学生” |


#### 4.1.2 编辑学生信息（UC3_1_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_1_2 |
| 用例名称 | 编辑学生信息 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标学生属于当前管理的校区 |
| 后置条件 | 学生信息更新至`student`表 |
| 基本流程 | 1. 校区管理员在学生列表中选择目标学生，点击“编辑”<br>2. 修改可编辑字段（姓名、联系电话、所属班级等）<br>3. 提交修改，系统调用`AdminService.updateStudent(studentId, updateData)`<br>4. 系统校验数据后保存，返回更新成功提示 |
| 扩展流程 | 1. 学生不属于本校区：系统提示“无权限编辑其他校区学生”<br>2. 学生不存在：系统提示“该学生不存在” |


### 4.2 教练管理
#### 4.2.1 搜索教练（UC3_2_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_2_1 |
| 用例名称 | 搜索教练 |
| 参与者 | 校区管理员 |
| 前置条件 | 校区管理员已登录系统 |
| 后置条件 | 系统返回本校区已认证教练的分页列表 |
| 基本流程 | 1. 校区管理员进入“教练管理-已认证列表”<br>2. 输入搜索条件（姓名、等级、专长）<br>3. 点击“搜索”，系统调用`AdminService.searchCertifiedCoaches(schoolId, keyword, page)`<br>4. 展示搜索结果（包含教练姓名、等级、带教班级等信息） |
| 扩展流程 | 1. 无搜索条件：返回本校区所有已认证教练分页数据<br>2. 无匹配结果：显示“未找到符合条件的教练” |


#### 4.2.2 编辑教练信息（UC3_2_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC3_2_2 |
| 用例名称 | 编辑教练信息 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标教练属于当前管理的校区且已认证 |
| 后置条件 | 教练信息更新至`coach`表 |
| 基本流程 | 1. 校区管理员在教练列表中选择目标教练，点击“编辑”<br>2. 修改可编辑字段（姓名、联系电话、授课时间等）<br>3. 提交修改，系统调用`AdminService.updateCoach(coachId, updateData)`<br>4. 系统校验数据后保存，返回更新成功提示 |
| 扩展流程 | 1. 教练不属于本校区：系统提示“无权限编辑其他校区教练”<br>2. 教练未认证：系统提示“请先完成教练认证” |


## 5. 线下学生充值（UC4）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC4 |
| 用例名称 | 线下学生充值 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标学生属于当前管理的校区 |
| 后置条件 | 1. 学生账户余额（`student_account.balance`）增加<br>2. 生成充值记录（`recharge_record`表新增记录） |
| 基本流程 | 1. 校区管理员进入“学生管理-充值”页面<br>2. 输入学生ID或扫码获取学生信息<br>3. 输入充值金额和支付方式（现金/微信/支付宝）<br>4. 点击“确认充值”，系统调用`PaymentService.offlineRecharge(studentId, amount, method)`<br>5. 充值成功后，显示充值记录详情（含交易号、时间） |
| 扩展流程 | 1. 学生不存在：系统提示“未找到该学生”<br>2. 充值金额≤0：系统提示“充值金额必须大于0”<br>3. 学生不属于本校区：系统提示“无权限为其他校区学生充值” |


## 6. 教练更换审批（UC5）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC5 |
| 用例名称 | 教练更换审批 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 存在本校区的教练更换申请（学生提交或系统自动发起） |
| 后置条件 | 1. 申请状态更新（`status`设为“通过”或“拒绝”）<br>2. 审批通过时，更新学生-教练关联关系（`student_coach`表） |
| 基本流程 | 1. 校区管理员进入“审批管理-教练更换”页面<br>2. 系统调用`AdminService.getCoachChangeApplications(schoolId)`获取待审批列表<br>3. 选择目标申请，查看详情（原教练、新教练、学生信息、更换原因）<br>4. 点击“通过”或“拒绝”，填写审批意见<br>5. 系统调用`AdminService.approveCoachChange(applicationId, result, opinion)`处理结果 |
| 扩展流程 | 1. 申请已被处理：系统提示“该申请已完成审批”<br>2. 新教练不属于本校区：系统提示“新教练不属于本校区，无法通过” |


## 7. 课表管理

### 7.1 创建校区课表（UC6_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6_1 |
| 用例名称 | 创建校区课表 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 当前管理的校区未创建课表 |
| 后置条件 | 课表信息保存至`schedule`表，关联校区ID |
| 基本流程 | 1. 校区管理员进入“课表管理-创建课表”页面<br>2. 选择课表模板（默认模板/自定义）<br>   - 默认模板：调用`ScheduleService.getDefaultTemplate()`获取标准课时安排<br>   - 自定义：手动设置每周各时段课程安排（含教练、场地）<br>3. 确认课表信息后点击“保存”，系统调用`ScheduleService.createSchedule(schoolId, scheduleData)`<br>4. 系统返回创建成功提示及课表预览 |
| 扩展流程 | 1. 校区已存在课表：系统提示“该校区已创建课表，请先修改或删除”<br>2. 课时冲突（同一时段同一场地安排多门课程）：系统提示“存在课时冲突，请调整” |


### 7.2 修改校区课表（UC6_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC6_2 |
| 用例名称 | 修改校区课表 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 当前管理的校区已创建课表 |
| 后置条件 | 课表信息更新至`schedule`表 |
| 基本流程 | 1. 校区管理员进入“课表管理-查看课表”页面<br>2. 系统调用`ScheduleService.getScheduleBySchoolId(schoolId)`获取当前课表<br>3. 点击“编辑”，修改课程安排（时间、教练、场地等）<br>4. 提交修改，系统调用`ScheduleService.updateSchedule(schoolId, newScheduleData)`<br>5. 系统校验无冲突后保存，返回更新成功提示 |
| 扩展流程 | 1. 校区无课表：系统提示“该校区未创建课表，请先创建”<br>2. 修改后存在课时冲突：系统提示“调整后存在冲突，请重新设置” |


## 8. 比赛管理

### 8.1 新增比赛（UC7_1）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC7_1 |
| 用例名称 | 新增比赛 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 比赛时间设置有效（报名截止时间≤比赛开始时间） |
| 后置条件 | 比赛信息保存至`competition`表，关联校区ID |
| 基本流程 | 1. 校区管理员进入“比赛管理-新增比赛”页面<br>2. 填写比赛信息（名称、类型、开始时间、报名截止时间、场地等）<br>3. 点击“保存”，系统调用`CompetitionService.createCompetition(schoolId, competitionData)`<br>4. 系统校验时间有效性后保存，返回创建成功提示 |
| 扩展流程 | 1. 报名截止时间晚于比赛时间：系统提示“报名截止时间不能晚于比赛开始时间”<br>2. 比赛场地不存在：系统提示“所选场地不存在，请重新选择” |


### 8.2 编辑比赛（UC7_2）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC7_2 |
| 用例名称 | 编辑比赛 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标比赛属于当前管理的校区且未开始 |
| 后置条件 | 比赛信息更新至`competition`表 |
| 基本流程 | 1. 校区管理员在比赛列表中选择目标比赛，点击“编辑”<br>2. 修改比赛信息（可修改项：名称、场地、报名截止时间等）<br>3. 提交修改，系统调用`CompetitionService.updateCompetition(competitionId, updateData)`<br>4. 系统校验数据后保存，返回更新成功提示 |
| 扩展流程 | 1. 比赛已开始：系统提示“比赛已开始，无法编辑”<br>2. 比赛不属于本校区：系统提示“无权限编辑其他校区比赛” |


### 8.3 安排赛程（UC7_3）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC7_3 |
| 用例名称 | 安排赛程 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标比赛属于当前管理的校区且已报名结束 |
| 后置条件 | 赛程信息保存至`schedule`表，关联比赛ID |
| 基本流程 | 1. 校区管理员进入比赛详情页，点击“安排赛程”<br>2. 系统根据报名人数自动生成赛程框架（小组赛/淘汰赛）<br>3. 管理员调整对阵信息、时间、场地等细节<br>4. 点击“确认发布”，系统调用`CompetitionService.arrangeSchedule(competitionId, scheduleData)`<br>5. 系统保存赛程并返回成功提示 |
| 扩展流程 | 1. 报名未结束：系统提示“报名尚未结束，无法安排赛程”<br>2. 赛程时间冲突：系统提示“部分场次时间冲突，请调整” |


### 8.4 查看赛程（UC7_4）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC7_4 |
| 用例名称 | 查看赛程 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 目标比赛已安排赛程 |
| 后置条件 | 系统展示比赛完整赛程（含各场次对阵、时间、结果） |
| 基本流程 | 1. 校区管理员进入比赛列表，选择目标比赛点击“查看赛程”<br>2. 系统调用`CompetitionService.getScheduleByCompetitionId(competitionId)`获取赛程数据<br>3. 以表格或 bracket 形式展示赛程，支持按阶段筛选（小组赛/半决赛/决赛） |
| 扩展流程 | 1. 未安排赛程：系统提示“该比赛尚未安排赛程”<br>2. 存在未更新结果的场次：显示“部分场次结果未更新”提示 |


## 9. 更换教练信息通知（UC8）
| 项目 | 内容 |
|------|------|
| 用例编号 | UC8 |
| 用例名称 | 更换教练信息通知 |
| 参与者 | 校区管理员 |
| 前置条件 | 1. 校区管理员已登录系统<br>2. 教练更换审批已通过 |
| 后置条件 | 1. 相关用户（学生、原教练、新教练）收到通知<br>2. 通知记录保存至`notification`表 |
| 基本流程 | 1. 教练更换审批通过后，系统自动触发通知流程<br>2. 校区管理员可在“通知管理”中预览通知内容（含更换原因、生效时间）<br>3. 系统调用`NotificationService.sendCoachChangeNotice(applicationId)`发送通知<br>   - 学生：收到“您的教练已更换”通知<br>   - 原教练：收到“您不再带教XX学生”通知<br>   - 新教练：收到“您已接手XX学生”通知 |
| 扩展流程 | 1. 部分用户通知发送失败：系统提示“部分通知发送失败，已重试”<br>2. 管理员手动重发：支持在通知记录页点击“重发”按钮 |